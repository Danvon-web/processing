<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Water Drop Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        let hand, waterImg;
        let backgrounds = [];
        let backgroundIndex = 0;
        let waters = [];
        let score = 0;
        let gameTime = 60;
        let gameStarted = false;
        let gameOver = false;
        let startbg;
        let customFont;
        
        function preload() {
            customFont = loadFont('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/webfonts/fa-solid-900.ttf'); // 替换为实际字体路径
            startbg = loadImage('1.png'); // 替换为你的开始界面背景图片
            for (let i = 0; i < 340; i++) {
                backgrounds[i] = loadImage(`data/1_${i}.png`); // 替换为你的背景图路径
            }
            waterImg = loadImage('water.png'); // 替换为水滴图像路径
            hand = loadImage('hand.png'); // 替换为手图像路径
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            textFont(customFont);
        }

        function draw() {
            background(255);
            if (!gameStarted) {
                showStartScreen();
            } else if (!gameOver) {
                runGame();
            } else {
                showGameOverScreen();
            }
        }

        function mousePressed() {
            if (!gameStarted && mouseX >= width / 2 - 100 && mouseX <= width / 2 + 100 &&
                mouseY >= height / 2 - 50 && mouseY <= height / 2 + 50) {
                gameStarted = true;
                score = 0;
                gameTime = 20;
                waters = [];
                backgroundIndex = 0;
                for (let i = 0; i < 10; i++) {
                    waters.push(new Water(random(width), random(height), waterImg));
                }
            }
        }

        function keyPressed() {
            if (gameOver && key === ' ') {
                gameStarted = false;
                gameOver = false;
            }
        }

        function showStartScreen() {
            image(startbg, 0, 0, width, height);
            fill(0);
            textSize(35);
            textAlign(CENTER, CENTER);
            text("Welcome to the Water Drop Game!", width / 2, height / 2 - 100);
            textSize(24);
            text("Collect water beads for points within the specified time.", width / 2, height / 2);
            text("Points can be exchanged for cat food to help stray cats.", width / 2, height / 2 + 40);

            fill(0, 150, 255);
            rect(width / 2 - 100, height / 2 + 60, 200, 50, 10);
            fill(255);
            textSize(24);
            text("START", width / 2, height / 2 + 85);
        }

        function runGame() {
            image(backgrounds[backgroundIndex], 0, 0, width, height);
            for (let i = waters.length - 1; i >= 0; i--) {
                let w = waters[i];
                w.update();
                w.display();
                if (!w.isFalling && dist(mouseX, mouseY, w.x, w.y) < w.size / 2 + 30) {
                    score += 10;
                    w.startFalling();
                    waters.push(new Water(random(width), random(height), waterImg));
                    if (backgroundIndex < backgrounds.length - 1) {
                        backgroundIndex++;
                    }
                }
                if (w.y > height) {
                    waters.splice(i, 1);
                }
            }

            image(hand, mouseX, mouseY);
            fill(255);
            textSize(32);
            text("Score: " + score, 20, 40);
            textAlign(RIGHT, TOP);
            text("Time: " + gameTime, width - 20, 40);

            if (frameCount % 60 === 0 && gameTime > 0) {
                gameTime--;
            }
            if (gameTime === 0 || score >= 500) {
                gameOver = true;
            }
        }

        function showGameOverScreen() {
            fill(0);
            textSize(48);
            textAlign(CENTER, CENTER);
            text("Game Over!", width / 2, height / 2 - 50);
            textSize(32);
            text("Your Score: " + score, width / 2, height / 2);
            textSize(24);
            text("Press SPACE to restart", width / 2, height / 2 + 50);
        }

        class Water {
            constructor(x, y, img) {
                this.x = x;
                this.y = y;
                this.img = img;
                this.size = 50; // 固定大小
                this.velocityY = 2;
                this.isFalling = false;
            }

            update() {
                if (this.isFalling) {
                    this.y += this.velocityY;
                }
            }

            startFalling() {
                this.isFalling = true;
            }

            display() {
                image(this.img, this.x, this.y, this.size, this.size);
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>
